<div class="pageContainer">
			
			<div id='map'>123</div>
			
		
			<div id="mapInfo">
				<div class="start_page">					
					<p id='trip_author'></p>
					<!-- <p id='trip_date'></p> -->
					<h4 id='trip_title'></h4>
					<button class="btn goBtn">GO<i class="glyphicon glyphicon-play"></i></button>
				</div>						
				<div class="trip_page">
					<div class="trip_bar">
						<span class="placeTitle">地點</span><br>
						<span id="prev" class="btn btn-link">前一個</span>
						<span id="next" class="btn btn-link">下一個</span>
					</div>
					<div class="trip_content article_content">
						
					</div>
				</div>
			</div>
		<div class="message">
			
			<div class="row">
				<div class="col-xs-6 col-xs-offset-2">
					<h4>留言</h4>
				</div>
				<div class="col-xs-6 col-xs-offset-2">					
					<input type="text" class="message_input form-control">
				</div>
				<div class="col-xs-2">
					<button class="btn message_btn">留言</button>
				</div>
			</div>
			<div class="row">
				<div class="col-xs-6 col-xs-offset-2 message_area">
				</div>
			</div>
		</div>
</div>
<style type="text/css">
@keyframes goBtn {
    0% {margin-left: 0px;}
    50% {margin-left: 5px;}
    100%{margin-left: 0px;}
}
	#map {
    z-index: 1;
    width: 50vw;
    height: 100vh;
    position: absolute;
    left: 0;
	}

	#mapInfo {
    margin: 0;
    padding: 0px;
    width: 50vw;
    height: 100vh;
    position: absolute;
   	left: 51vw;
   	background-color: white;
    /* overflow-y: scroll; */
    z-index: 1;
	}
	#trip_author{
		margin-top: 20vh;
	}
	.trip_page{
		display: none;
	}
	.trip_bar{
		font-size: 20px;
		color: gray;
		text-align: center;
	}
	.start_page{
		text-align: center;
	}
	.goBtn{
		background-color: lightblue;
		color: white;
	}
	.goBtn:hover > i{
		animation-name: goBtn;
    	animation-duration: .5s;
	}
	.trip_page{
		height: 90vh;
		overflow-y: scroll;
		overflow-x: hidden;
	}
	.trip_content{
		padding-top: 10vh;
	}
	.trip_content img{
		width: 95%;
	}
	.message{
	position: absolute;
	top: 100vh;
	width: 100%;
	border-top:1px solid lightgray;
	margin-top:150px; 
	padding-bottom: 100px;
}
	.message_area p{
	border-bottom: 1px solid lightgray;
	padding: 5px;
	font-size:16px;
	color: gray;
}
.message_area small{
	float: right;
	color: lightgray;
}

@media (max-width:500px) {
     #map {
    width:100vw;
    height: 100vh;
   
}
#welcomeOption{
	display: inline-block;
}
#mapInfo {
	left: 0;
    width: 100vw;
    height: 100vh;
    padding-bottom: 200px;
}
    .message{
	border-top:1px solid lightgray;
	margin-top:50px; 
	padding-bottom: 40px;
		}
   }
</style>
<script type="text/javascript">
var map,
	service,
	marker=[],
	mapArticle=[],
	pageCount=0,
	start,
	bounds;
newMap()
welcomeOption('地圖',welcomeClick )
function welcomeClick(e, target){
    console.log('welcomeOption')
    target.toggleClass('showNow')
    if(target.hasClass('showNow')){
            $('#map').css('zIndex', '5')        
    }else{
            $('#map').css('zIndex', '0')
    }
}
Message($('.message_input'),$('.message_btn'),'message_map',_tripObj.id,'singleTrip')
function newMap(){
	console.log('newMap');
	 map= new google.maps.Map(document.getElementById('map'), {
      center: {lat:24,lng:121.2},
      zoom: 10,
      disableDefaultUI: true,
      disableDoubleClickZoom: true
    //scrollwheel: false
  	});
	service = new google.maps.places.PlacesService(map)
	getPlaces()
}

function CleanMapMarker(){
	console.log('CleanMapMarker');
	for(var i=0;i<marker.length;i++){
		marker[i].mark.setMap(null);
	}
	marker=[];
	mapArticle=[];
	pageCount=-1;
}
function _btn(length){
	$('.goBtn').on('click',function(){
		$('.start_page').css('display','none')
		$('.trip_page').css('display','block')
		map.setZoom(14)
		PageEvent(length)
	})
	$('.trip_bar').find('#prev').on('click',function(){
		if(pageCount!=0)
			pageCount--
		PageEvent(length)
	})
	$('.trip_bar').find('#next').on('click',function(){
		if(pageCount!=length-1)
			pageCount++
		PageEvent(length)
	})
}
function getPlaces(){
	//$('#trip_date').text(_tripObj.date)
	$('#trip_title').text(_tripObj.title)
	$('#trip_author').text(_tripObj.author)
	AjaxPost('article/single_mapArticle',{id:_tripObj.id},function(res){
		var place=res.Places,
			article=res.Articles,
			message=res.Message	
		$.map(message,function(mes){
			$('.message_area').prepend('<p>'+mes.message+
							'<small>'+mes.name+' '+
							mes.date.toString().substring(0,10)+'</small></p>')
		})
		Promise.all(getDetail(place)).then(()=>{
			CreateArticle(article)
			_btn(res.Articles.length)
			Direction()
		})	
		
	})
}
function CreateMarker(result,i,resolve,reject){	
	var infowindow=new google.maps.InfoWindow();
				var mark = new google.maps.Marker({
    				map: map,
    				position: result.geometry.location,
    				icon: {
    					url: 'img/blue-dot.png',
                		scaledSize: { width: 40, height: 32 }
    				}
  					})
				infowindow.setContent((i+1)+'.'+result.name)
				infowindow.open(map,mark);
				marker[i]={
					mark:mark,
					center:result.geometry.location,
					name:result.name
				}
				if (result.geometry.viewport) {// Only geocodes have viewport.
        			bounds.union(result.geometry.viewport);} 
        		else {bounds.extend(result.geometry.location);}        		
        		map.fitBounds(bounds)
        		return resolve()
}
function getDetail(place){
	var promise=[]
	bounds=new google.maps.LatLngBounds()
	$.map(place,function(_place,i){
		promise.push(new Promise(function(resolve,reject){
			service.getDetails({placeId:_place}, function(result,status){
			if(status === google.maps.places.PlacesServiceStatus.OK){							
					CreateMarker(result,i,resolve,reject)
				}//if(status == google.maps.places.PlacesServiceStatus.OK)
			});//service.getDetails	
		}))		
	})	
	return promise		
}
function Direction(){
	let waypoints=[]
	for (var i = 0; i < marker.length; i++) {
		if(i!=0&&i!=marker.length-1)
		waypoints.push({location:marker[i].center})
	}
	console.log(waypoints[0])
	let directions = new google.maps.DirectionsService(),
		request={
			origin: marker[0].center,
            destination: marker[marker.length-1].center,
            waypoints:waypoints,
            optimizeWaypoints: true,
            travelMode:'DRIVING'
		}
	directions.route(request, function(result, status) {
		if(status=='OK'){
			let display = new google.maps.DirectionsRenderer({
           		 map: map,
           		 directions:result
        	})
        	display.setOptions({ suppressMarkers: true })
		}
	})
}
function CreateArticle(article){
	$.map(article,function(art){
		mapArticle.push(art)
	})
	$('.trip_content').html(mapArticle[pageCount])
}
function PageEvent(length){
	if(pageCount==0)
		$('#prev').css('display','none')
	else
		$('#prev').css('display','inline')
	if(pageCount==length-1)
		$('#next').css('display','none')
	else
		$('#next').css('display','inline')
	$('.trip_content').html(mapArticle[pageCount])
	$('.placeTitle').text(marker[pageCount].name)
	//map.setZoom(14)
	map.panTo(marker[pageCount].center)
}
</script>