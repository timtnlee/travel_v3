<div class="pageContainer">
		<div class="row">
			<div class="col-sm-6">
				<div id='map'>123</div>
			</div>
		
			<div class="col-sm-6">
				<div class="start_page">					
					<p id='trip_author'></p>
					<!-- <p id='trip_date'></p> -->
					<h4 id='trip_title'></h4>
					<button class="btn goBtn">GO<i class="glyphicon glyphicon-play"></i></button>
				</div>						
				<div class="trip_page">
					<div class="trip_bar">
						<span id="prev" class="btn dayBtn glyphicon glyphicon-triangle-left"></span>
						<span class="placeTitle">地點</span>
						<span id="next" class="btn dayBtn glyphicon glyphicon-triangle-right"></span>
					</div>
					<div class="trip_content article_content">
						
					</div>
				</div>
			</div>
		</div>
</div>
<style type="text/css">
@keyframes goBtn {
    0% {margin-left: 0px;}
    50% {margin-left: 5px;}
    100%{margin-left: 0px;}
}
	#map{
		width:100%;
		height: 90vh;
	}
	#trip_author{
		margin-top: 20vh;
	}
	.trip_page{
		display: none;
	}
	.trip_bar{
		font-size: 20px;
		color: gray;
		text-align: center;
	}
	.start_page{
		text-align: center;
	}
	.goBtn{
		background-color: lightblue;
		color: white;
	}
	.goBtn:hover > i{
		animation-name: goBtn;
    	animation-duration: .5s;
	}
	.trip_page{
		height: 90vh;
		overflow-y: scroll;
		overflow-x: hidden;
	}
	.trip_content{
		padding-top: 10vh;
	}
	.trip_content img{
		width: 95%;
	}
</style>
<script type="text/javascript">
var map,
	service,
	marker=[],
	mapArticle=[],
	pageCount=0,
	start,
	bounds;
newMap()
function newMap(){
	console.log('newMap');
	 map= new google.maps.Map(document.getElementById('map'), {
      center: {lat:24,lng:121.2},
      zoom: 10,
      disableDefaultUI: true,
      disableDoubleClickZoom: true
    //scrollwheel: false
  	});
	service = new google.maps.places.PlacesService(map)
	getPlaces()
}

function CleanMapMarker(){
	console.log('CleanMapMarker');
	for(var i=0;i<marker.length;i++){
		marker[i].mark.setMap(null);
	}
	marker=[];
	mapArticle=[];
	pageCount=-1;
}
function _btn(length){
	$('.goBtn').on('click',function(){
		$('.start_page').css('display','none')
		$('.trip_page').css('display','block')
		map.setZoom(14)
		PageEvent()
	})
	$('.trip_bar').find('#prev').on('click',function(){
		if(pageCount!=0)
			pageCount--
		PageEvent()
	})
	$('.trip_bar').find('#next').on('click',function(){
		if(pageCount!=length-1)
			pageCount++
		PageEvent()
	})
}
function getPlaces(){
	//$('#trip_date').text(_tripObj.date)
	$('#trip_title').text(_tripObj.title)
	$('#trip_author').text(_tripObj.author)
	AjaxPost('article/single_mapArticle',{id:_tripObj.id},function(res){
		var place=res.Places,
			article=res.Articles		
			
		Promise.all(getDetail(place)).then(()=>{
			CreateArticle(article)
			_btn(res.Articles.length)
			Direction()
		})	
		
	})
}
function CreateMarker(result,i,resolve,reject){	
	var infowindow=new google.maps.InfoWindow();
				var mark = new google.maps.Marker({
    				map: map,
    				position: result.geometry.location,
    				icon: {
    					url: 'img/blue-dot.png',
                		scaledSize: { width: 40, height: 32 }
    				}
  					})
				infowindow.setContent(i+'.'+result.name)
				infowindow.open(map,mark);
				marker[i]={
					mark:mark,
					center:result.geometry.location,
					name:result.name
				}
				if (result.geometry.viewport) {// Only geocodes have viewport.
        			bounds.union(result.geometry.viewport);} 
        		else {bounds.extend(result.geometry.location);}        		
        		map.fitBounds(bounds)
        		return resolve()
}
function getDetail(place){
	var promise=[]
	bounds=new google.maps.LatLngBounds()
	$.map(place,function(_place,i){
		promise.push(new Promise(function(resolve,reject){
			service.getDetails({placeId:_place}, function(result,status){
			if(status === google.maps.places.PlacesServiceStatus.OK){							
					CreateMarker(result,i,resolve,reject)
				}//if(status == google.maps.places.PlacesServiceStatus.OK)
			});//service.getDetails	
		}))		
	})	
	return promise		
}
function Direction(){
	let waypoints=[]
	for (var i = 0; i < marker.length; i++) {
		if(i!=0&&i!=marker.length-1)
		waypoints.push({location:marker[i].center})
	}
	console.log(waypoints[0])
	let directions = new google.maps.DirectionsService(),
		request={
			origin: marker[0].center,
            destination: marker[marker.length-1].center,
            waypoints:waypoints,
            optimizeWaypoints: true,
            travelMode:'DRIVING'
		}
	directions.route(request, function(result, status) {
		if(status=='OK'){
			let display = new google.maps.DirectionsRenderer({
           		 map: map,
           		 directions:result
        	})
        	display.setOptions({ suppressMarkers: true })
		}
	})
}
function CreateArticle(article){
	$.map(article,function(art){
		mapArticle.push(art)
	})
	$('.trip_content').html(mapArticle[pageCount])
}
function PageEvent(){
	$('.trip_content').html(mapArticle[pageCount])
	$('.placeTitle').text(marker[pageCount].name)
	//map.setZoom(14)
	map.panTo(marker[pageCount].center)
}
</script>