<div class="_loading"><i class="fa fa-spinner fa-spin fa-3x fa-fw"></i></div>
<div class="pageContainer">
<div class="pageMiddle">
	<div class="row">
		<div class="col-sm-6">	
			<button class="btn btn-success btn-xs" id='iconUploadBtn'>上傳</button>
			<br>
			<input type="file" name="" id='iconUploadInput' accept="image/*"> 			
			<img id='usericon' src='img/icon.png'>
		</div>
		<div class="col-sm-6">
			<h4 id='personal_name'></h4>
			<h4 id='personal_article'>文章:</h4>
			<h4 id='personal_schedule'>行程:</h4>
		</div>
	</div>
</div>
</div>
<script>
uploadIcon();
if(localStorage.logined=='yes'){
$('._loading').css('display','block');
AjaxPost(
	'user/personal',
	{name:localStorage.username},
	function(res){

		var article=0;
		for(let i in res.articles){
			$('#personal_article')
			.append('<p href="#singleArticle">'+res.articles[i].Title+'</p>')
			.find('p').last()
			.click(function(){
			_articleObj.title=res.articles[i].Title,
			_articleObj.author=res.articles[i].Username,
			_articleObj.date=res.articles[i].Date,
			_articleObj.id=res.articles[i]._id
			location.href=$(this).attr('href')
			})
		}
		if(res.schedules){
			console.log(res.schedules)
		for (var i = 0; i <res.schedules.length; i++) {
				var title=res.schedules[i].Title,
					schedule=res.schedules[i].Schedule
				$('#personal_schedule').append(
					'<p href="#schedule">'
					+title+'</p>')
					.find('p').last().on('click',function(){
						location.href=$(this).attr('href')
						_display_title=title
 						_display_place=schedule
						// var schObj={
						// 	title:title,
						// 	place:place,
						// 	mode:mode
						// }
						// personal_schedule_click(schObj);
					})
			}
		}
		$('#usericon').attr('src',res.icon);
		$('._loading').css('display','none');
	}
	)
	$('#personal_name').text('名稱: '+localStorage.username);}
// function personal_schedule_click(schObj){
// 		_display_title=schObj.title,
// 		_display_place=schObj.place,
// 		_display_mode=schObj.mode;
// }
function uploadIcon(){
	$('#iconUploadBtn').click(function(){
		$('#iconUploadInput').click();
	})
	InsertImg('#iconUploadInput',SaveIcon);
}
function SaveIcon(result){
		block();
		AjaxPost('user/picture',{username:localStorage.username,result:result},function(res){
			alert(res);
			close_block();
			reNewPage('personal');
		})
}
</script>

<style>
	#iconUploadInput{
		display: none;
	}
	#usericon{
		width: 90%;
	}
	#personal_article p{
		cursor:  pointer;
		background-color: lightgray;
		margin: 10px 0px 10px 0px;
		padding: 5px;
	}
	#personal_schedule p{
		cursor:  pointer;
		background-color: lightskyblue;
		margin: 10px 0px 10px 0px;
		padding: 5px;
	}
</style>